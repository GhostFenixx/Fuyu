@using Fuyu.Launcher.Core.Services;

@inject NavigationManager Navigation

@page "/"
@page "/login"

<FluentStack Orientation="Orientation.Vertical">

    <!-- server settings -->
    <FluentAccordionItem Heading="Login" Expanded=true Style="width: 100%;">
	    <FluentLabel>Username:</FluentLabel>
        <FluentTextField TextFieldType="TextFieldType.Text" @bind-Value="username" Style="width: 100%;"></FluentTextField>
        <FluentLabel>Password:</FluentLabel>
        <FluentTextField TextFieldType="TextFieldType.Password" @bind-Value="password" Style="width: 100%;"></FluentTextField>
        <br />
        <br />
        <FluentButton Appearance="Appearance.Accent" OnClick="Login_Clicked">Login</FluentButton>
        <a href="/register"><FluentLabel>Register</FluentLabel></a>
    </FluentAccordionItem>

</FluentStack>

@code
{
    string username = string.Empty;
    string password = string.Empty;

    private void Login_Clicked(EventArgs e)
    {
        var hashedPassword = HashService.GetSHA256(password);
        var sessionId = RequestService.LoginAccount(username, hashedPassword);

        if (sessionId == string.Empty)
        {
            // TODO:
            // * show error
            // -- seionmoya, 2024/09/02
        }

        RequestService.CreateSession(sessionId);
        Navigation.NavigateTo($"/account?sessionid={sessionId}");
    }
}
