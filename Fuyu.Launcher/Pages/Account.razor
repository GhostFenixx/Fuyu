@using Fuyu.Platform.Launcher.Services

@page "/"
@page "/account"

<FluentStack Orientation="Orientation.Vertical">

    <FluentButton Appearance="Appearance.Accent" IconStart="@(new Icons.Regular.Size24.Play())" OnClick="StartEft">Start Game</FluentButton>

</FluentStack>

@code
{
    // placeholder
    string username = "Senko-san";
    string password = "test";
    string edition = "unheard";

    // TODO:
    // * Move the login and registering into other pages
    // -- seionmoya, 2024/09/02
    private void StartEft()
    {
        var hashedPassword = HashService.GetSHA256(password);

        // register account
        var registerStatus = RequestService.RegisterAccount(username, hashedPassword, edition);

        switch (registerStatus)
        {
            case ERegisterStatus.Success:
                break;

            case ERegisterStatus.AlreadyExists:
                break;
        }

        // login account
        var sessionId = RequestService.LoginAccount(username, hashedPassword);

        // run game
        using (var process = ProcessService.StartEft(SettingsService.ClientDirectory, sessionId, SettingsService.EftAddress))
        {
            process.Start();
        }
    }
}
